<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>√âvaluation BAC PRO AMA CVPM</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    /* Login */
    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .login-box {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      max-width: 400px;
      width: 100%;
      overflow: hidden;
    }

    .login-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .login-header h1 {
      font-size: 24px;
      margin-bottom: 10px;
    }

    .login-header p {
      opacity: 0.9;
      font-size: 14px;
    }

    .login-form {
      padding: 30px;
    }

    .login-form h2 {
      margin-bottom: 20px;
      color: #333;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-weight: 600;
      font-size: 14px;
    }

    .form-group input, .form-group select, .form-group textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s;
      font-family: inherit;
    }

    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }

    .btn-primary {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      padding: 10px 20px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      margin: 10px 0;
    }

    .btn-secondary:hover {
      background: #5568d3;
    }

    .error-message {
      background: #fee;
      color: #c33;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #c33;
    }

    .success-message {
      background: #e8f5e9;
      color: #2e7d32;
      padding: 12px;
      border-radius: 8px;
      margin: 20px 0;
      border-left: 4px solid #4caf50;
    }

    .hidden {
      display: none !important;
    }

    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .modal-content {
      background: white;
      border-radius: 16px;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .modal-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px 30px;
      border-radius: 16px 16px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h3 {
      font-size: 20px;
    }

    .modal-close {
      background: none;
      border: none;
      color: white;
      font-size: 28px;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-body {
      padding: 30px;
    }

    /* App Container */
    .app-container {
      min-height: 100vh;
      padding: 20px;
    }

    .app-header {
      background: rgba(255,255,255,0.95);
      border-radius: 16px;
      padding: 30px;
      text-align: center;
      margin-bottom: 30px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      position: relative;
    }

    .app-header h1 {
      font-size: 28px;
      color: #333;
      margin-bottom: 10px;
    }

    .app-header p {
      color: #666;
      font-size: 14px;
    }

    .btn-logout {
      position: absolute;
      top: 30px;
      right: 30px;
      padding: 10px 20px;
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    .btn-logout:hover {
      background: #c82333;
    }

    /* Dashboard */
    .dashboard {
      max-width: 1200px;
      margin: 0 auto;
    }

    .dashboard h2 {
      color: white;
      font-size: 32px;
      margin-bottom: 30px;
      text-align: center;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 30px rgba(0,0,0,0.2);
    }

    .card h3 {
      font-size: 22px;
      color: #333;
      margin-bottom: 10px;
    }

    .card p {
      color: #666;
      font-size: 14px;
    }

    /* Content */
    .content {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .content h2 {
      color: #333;
      margin-bottom: 20px;
    }

    .btn-back {
      padding: 10px 20px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      margin-bottom: 20px;
    }

    .btn-back:hover {
      background: #5568d3;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .list-item {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      border-left: 4px solid #667eea;
    }

    .list-item h4 {
      color: #333;
      margin-bottom: 5px;
    }

    .list-item p {
      color: #666;
      font-size: 14px;
    }

    .checkbox-group {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .checkbox-label {
      display: flex;
      align-items: center;
      padding: 8px;
      background: #f8f9fa;
      border-radius: 4px;
      cursor: pointer;
    }

    .checkbox-label input {
      margin-right: 8px;
      width: auto;
    }

    .stars {
      display: flex;
      gap: 5px;
      margin-top: 5px;
    }

    .star {
      font-size: 24px;
      cursor: pointer;
      color: #ddd;
    }

    .star.active {
      color: #ffc107;
    }
  </style>
</head>
<body>
  <!-- Login Page -->
  <div id="login-page" class="login-container">
    <div class="login-box">
      <div class="login-header">
        <h1>üìö √âvaluation BAC PRO AMA CVPM</h1>
        <p>Communication Visuelle Plurim√©dia</p>
      </div>

      <form id="login-form" class="login-form">
        <h2>Connexion</h2>
        
        <div id="login-error" class="error-message hidden"></div>

        <div class="form-group">
          <label>Email</label>
          <input type="email" id="login-email" placeholder="votre.email@exemple.fr" required>
        </div>

        <div class="form-group">
          <label>Mot de passe</label>
          <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
        </div>

        <button type="submit" class="btn-primary">Se connecter</button>
      </form>
    </div>
  </div>

  <!-- Dashboard -->
  <div id="dashboard-page" class="app-container hidden">
    <header class="app-header">
      <h1>üìö √âvaluation BAC PRO AMA CVPM</h1>
      <p>Communication Visuelle Plurim√©dia</p>
      <button id="logout-btn" class="btn-logout">D√©connexion</button>
    </header>

    <div class="dashboard">
      <h2 id="welcome-msg">Bonjour üëã</h2>
      
      <div class="dashboard-grid">
        <div class="card" onclick="showPage('students')">
          <h3>üë• G√©rer les √©l√®ves</h3>
          <p>Ajouter, modifier ou supprimer des √©l√®ves</p>
        </div>

        <div class="card" onclick="showPage('sequences')">
          <h3>üìã S√©quences p√©dagogiques</h3>
          <p>Cr√©er et g√©rer vos s√©quences</p>
        </div>

        <div class="card">
          <h3>‚úÖ √âvaluations</h3>
          <p>√âvaluer les comp√©tences des √©l√®ves</p>
        </div>

        <div class="card">
          <h3>üìä Statistiques</h3>
          <p>Consulter les r√©sultats et progressions</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Students Page -->
  <div id="students-page" class="app-container hidden">
    <header class="app-header">
      <h1>üìö √âvaluation BAC PRO AMA CVPM</h1>
    </header>

    <div class="content">
      <button class="btn-back" onclick="showPage('dashboard')">‚Üê Retour</button>
      
      <h2>Gestion des √©l√®ves</h2>
      
      <div id="students-message" class="success-message">
        ‚úÖ Connect√© √† Google Sheets !
      </div>

      <button class="btn-primary" style="max-width: 200px;" onclick="openAddStudentModal()">‚ûï Ajouter un √©l√®ve</button>

      <div id="students-list" class="loading">Chargement des √©l√®ves...</div>
    </div>
  </div>

  <!-- Sequences Page -->
  <div id="sequences-page" class="app-container hidden">
    <header class="app-header">
      <h1>üìö √âvaluation BAC PRO AMA CVPM</h1>
    </header>

    <div class="content">
      <button class="btn-back" onclick="showPage('dashboard')">‚Üê Retour</button>
      
      <h2>S√©quences p√©dagogiques</h2>
      
      <div id="sequences-message" class="success-message">
        ‚úÖ Connect√© √† Google Sheets !
      </div>

      <button class="btn-primary" style="max-width: 230px;" onclick="openAddSequenceModal()">‚ûï Cr√©er une s√©quence</button>

      <div id="sequences-list" class="loading">Chargement des s√©quences...</div>
    </div>
  </div>

  <!-- Modal Add Student -->
  <div id="add-student-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>‚ûï Ajouter un √©l√®ve</h3>
        <button class="modal-close" onclick="closeAddStudentModal()">√ó</button>
      </div>
      <div class="modal-body">
        <form id="add-student-form">
          <div class="form-group">
            <label>Nom *</label>
            <input type="text" id="student-nom" required>
          </div>

          <div class="form-group">
            <label>Pr√©nom *</label>
            <input type="text" id="student-prenom" required>
          </div>

          <div class="form-group">
            <label>Classe *</label>
            <select id="student-classe" required>
              <option value="">S√©lectionnez une classe</option>
              <option value="2nde">2nde</option>
              <option value="1√®re">1√®re</option>
              <option value="Terminale">Terminale</option>
            </select>
          </div>

          <div id="add-student-error" class="error-message hidden"></div>
          <div id="add-student-success" class="success-message hidden"></div>

          <button type="submit" class="btn-primary" id="add-student-btn">Ajouter l'√©l√®ve</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal Add Sequence -->
  <div id="add-sequence-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>‚ûï Cr√©er une s√©quence</h3>
        <button class="modal-close" onclick="closeAddSequenceModal()">√ó</button>
      </div>
      <div class="modal-body">
        <form id="add-sequence-form">
          <div class="form-group">
            <label>Titre *</label>
            <input type="text" id="sequence-titre" required>
          </div>

          <div class="form-group">
            <label>Niveau *</label>
            <select id="sequence-niveau" required>
              <option value="">S√©lectionnez un niveau</option>
              <option value="2nde">2nde</option>
              <option value="1√®re">1√®re</option>
              <option value="Terminale">Terminale</option>
            </select>
          </div>

          <div class="form-group">
            <label>√âpreuves *</label>
            <select id="sequence-epreuves" required>
              <option value="">S√©lectionnez une √©preuve</option>
              <option value="E11">E11</option>
              <option value="E33">E33</option>
              <option value="E11,E33">E11 + E33</option>
            </select>
          </div>

          <div class="form-group">
            <label>Objectif</label>
            <input type="text" id="sequence-objectif">
          </div>

          <div class="form-group">
            <label>Description</label>
            <textarea id="sequence-description"></textarea>
          </div>

          <div id="add-sequence-error" class="error-message hidden"></div>
          <div id="add-sequence-success" class="success-message hidden"></div>

          <button type="submit" class="btn-primary" id="add-sequence-btn">Cr√©er la s√©quence</button>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Configuration
    const API_KEY = 'AIzaSyCk8YbmkxKxbcIWInC3sqxqCUwY3xImMQk';
    const SHEET_ID = '1tL65Vv77SBrUWqeFOPte3AWPeYM1BC5Cy8UDwGwaO40';
    
    // URL du backend Apps Script
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyZC6uyLv-_Yq5kBsRKgNihue_CrN0-WqOA1z-hkrUfrkoXCV3rQZTxUE_mR9B6XI059w/exec';
    
    let currentUser = null;

    // Navigation
    function showPage(pageName) {
      document.querySelectorAll('.login-container, .app-container').forEach(el => {
        el.classList.add('hidden');
      });

      if (pageName === 'login') {
        document.getElementById('login-page').classList.remove('hidden');
      } else if (pageName === 'dashboard') {
        document.getElementById('dashboard-page').classList.remove('hidden');
      } else if (pageName === 'students') {
        document.getElementById('students-page').classList.remove('hidden');
        loadStudents();
      } else if (pageName === 'sequences') {
        document.getElementById('sequences-page').classList.remove('hidden');
        loadSequences();
      }
    }

    // Modals
    function openAddStudentModal() {
      document.getElementById('add-student-modal').classList.remove('hidden');
      document.getElementById('add-student-form').reset();
      document.getElementById('add-student-error').classList.add('hidden');
      document.getElementById('add-student-success').classList.add('hidden');
    }

    function closeAddStudentModal() {
      document.getElementById('add-student-modal').classList.add('hidden');
    }

    function openAddSequenceModal() {
      document.getElementById('add-sequence-modal').classList.remove('hidden');
      document.getElementById('add-sequence-form').reset();
      document.getElementById('add-sequence-error').classList.add('hidden');
      document.getElementById('add-sequence-success').classList.add('hidden');
    }

    function closeAddSequenceModal() {
      document.getElementById('add-sequence-modal').classList.add('hidden');
    }

    // Login
    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      const errorDiv = document.getElementById('login-error');

      errorDiv.classList.add('hidden');

      try {
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Utilisateurs?key=${API_KEY}`;
        const response = await fetch(url);
        const data = await response.json();

        if (data.values) {
          const users = data.values.slice(1);
          const user = users.find(row => row[0] === email && row[2] === password);

          if (user) {
            currentUser = { email: user[0], nom: user[1] };
            document.getElementById('welcome-msg').textContent = `Bonjour ${user[1]} üëã`;
            showPage('dashboard');
          } else {
            errorDiv.textContent = 'Identifiant ou mot de passe incorrect';
            errorDiv.classList.remove('hidden');
          }
        }
      } catch (error) {
        errorDiv.textContent = 'Erreur de connexion au serveur';
        errorDiv.classList.remove('hidden');
      }
    });

    // Logout
    document.getElementById('logout-btn').addEventListener('click', () => {
      currentUser = null;
      document.getElementById('login-email').value = '';
      document.getElementById('login-password').value = '';
      showPage('login');
    });

    // Add Student
    document.getElementById('add-student-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const nom = document.getElementById('student-nom').value;
      const prenom = document.getElementById('student-prenom').value;
      const classe = document.getElementById('student-classe').value;
      
      const errorDiv = document.getElementById('add-student-error');
      const successDiv = document.getElementById('add-student-success');
      const btn = document.getElementById('add-student-btn');

      errorDiv.classList.add('hidden');
      successDiv.classList.add('hidden');
      btn.disabled = true;
      btn.textContent = 'Ajout en cours...';

      try {
        const response = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          mode: 'cors',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            action: 'addStudent',
            data: { nom, prenom, classe }
          })
        });

        const result = await response.json();

        if (result.success) {
          successDiv.textContent = `‚úÖ ${prenom} ${nom} a √©t√© ajout√© avec succ√®s !`;
          successDiv.classList.remove('hidden');
          document.getElementById('add-student-form').reset();
          
          setTimeout(() => {
            closeAddStudentModal();
            loadStudents();
          }, 1500);
        } else {
          errorDiv.textContent = result.message || 'Erreur lors de l\'ajout';
          errorDiv.classList.remove('hidden');
        }
      } catch (error) {
        errorDiv.textContent = 'Erreur de connexion au serveur';
        errorDiv.classList.remove('hidden');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Ajouter l\'√©l√®ve';
      }
    });

    // Add Sequence
    document.getElementById('add-sequence-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const titre = document.getElementById('sequence-titre').value;
      const niveau = document.getElementById('sequence-niveau').value;
      const epreuves = document.getElementById('sequence-epreuves').value;
      const objectif = document.getElementById('sequence-objectif').value;
      const description = document.getElementById('sequence-description').value;
      
      const errorDiv = document.getElementById('add-sequence-error');
      const successDiv = document.getElementById('add-sequence-success');
      const btn = document.getElementById('add-sequence-btn');

      errorDiv.classList.add('hidden');
      successDiv.classList.add('hidden');
      btn.disabled = true;
      btn.textContent = 'Cr√©ation en cours...';

      try {
        const response = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          mode: 'cors',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            action: 'addSequence',
            data: { titre, niveau, epreuves, objectif, description }
          })
        });

        const result = await response.json();

        if (result.success) {
          successDiv.textContent = `‚úÖ La s√©quence "${titre}" a √©t√© cr√©√©e avec succ√®s !`;
          successDiv.classList.remove('hidden');
          document.getElementById('add-sequence-form').reset();
          
          setTimeout(() => {
            closeAddSequenceModal();
            loadSequences();
          }, 1500);
        } else {
          errorDiv.textContent = result.message || 'Erreur lors de la cr√©ation';
          errorDiv.classList.remove('hidden');
        }
      } catch (error) {
        errorDiv.textContent = 'Erreur de connexion au serveur';
        errorDiv.classList.remove('hidden');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Cr√©er la s√©quence';
      }
    });

    // Load Students
    async function loadStudents() {
      const listDiv = document.getElementById('students-list');
      listDiv.innerHTML = '<div class="loading">Chargement des √©l√®ves...</div>';

      try {
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Eleves?key=${API_KEY}`;
        const response = await fetch(url);
        const data = await response.json();

        if (data.values && data.values.length > 1) {
          const students = data.values.slice(1);
          let html = '';
          
          students.forEach(student => {
            if (student[0]) {
              html += `
                <div class="list-item">
                  <h4>${student[2]} ${student[1]}</h4>
                  <p>Classe: ${student[3]} - Ann√©e: ${student[4]}</p>
                </div>
              `;
            }
          });

          listDiv.innerHTML = html || '<p>Aucun √©l√®ve trouv√©.</p>';
        } else {
          listDiv.innerHTML = '<p>Aucun √©l√®ve trouv√©.</p>';
        }
      } catch (error) {
        listDiv.innerHTML = '<div class="error-message">Erreur lors du chargement des √©l√®ves</div>';
      }
    }

    // Load Sequences
    async function loadSequences() {
      const listDiv = document.getElementById('sequences-list');
      listDiv.innerHTML = '<div class="loading">Chargement des s√©quences...</div>';

      try {
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Sequences?key=${API_KEY}`;
        const response = await fetch(url);
        const data = await response.json();

        if (data.values && data.values.length > 1) {
          const sequences = data.values.slice(1);
          let html = '';
          
          sequences.forEach(seq => {
            if (seq[0]) {
              html += `
                <div class="list-item">
                  <h4>${seq[1]}</h4>
                  <p>Niveau: ${seq[2]} - √âpreuves: ${seq[3]}</p>
                </div>
              `;
            }
          });

          listDiv.innerHTML = html || '<p>Aucune s√©quence trouv√©e.</p>';
        } else {
          listDiv.innerHTML = '<p>Aucune s√©quence trouv√©e.</p>';
        }
      } catch (error) {
        listDiv.innerHTML = '<div class="error-message">Erreur lors du chargement des s√©quences</div>';
      }
    }

    // Initialize
    showPage('login');
  </script>
</body>
</html>
